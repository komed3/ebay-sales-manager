function renderReportChart(r,t){t=Object.fromEntries(Object.entries(t).reverse().slice(0,24).reverse());const o=[],e=[],a=[],l=[],i=[],d=[];for(const[r,n]of Object.entries(t))o.push(r.replaceAll("-","/")),e.push(n.totalShipping),a.push(n.totalFees),l.push(n.totalRefund),i.push(n.totalProfit),d.push(n.profitMargin);new Chart(r,{type:"bar",data:{labels:o,datasets:[{data:d,type:"line",yAxisID:"y2",label:I18N.chart.margin,pointRadius:6,pointHoverRadius:6,tension:.3,backgroundColor:"#fff",hoverBackgroundColor:"#fff",borderColor:"#000",borderWidth:2,hoverBorderWidth:2,clip:!1},{data:e,stack:"finances",label:I18N.chart.shippingCosts,backgroundColor:"#ffbb00",hoverBackgroundColor:"#ffbb00",borderWidth:0},{data:a,stack:"finances",label:I18N.chart.fees,backgroundColor:"#fb6542",hoverBackgroundColor:"#fb6542",borderWidth:0},{data:l,stack:"finances",label:I18N.chart.refund,backgroundColor:"#698bbe",hoverBackgroundColor:"#698bbe",borderWidth:0},{data:i,stack:"finances",label:I18N.chart.profit,backgroundColor:"#78ac4c",hoverBackgroundColor:"#78ac4c",borderWidth:0}]},options:{interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"bottom",labels:{font:{size:15},boxWidth:24}},tooltip:{callbacks:{label:r=>`${r.dataset.label}: ${0==r.datasetIndex?formatPercent(r.raw/100):formatMoney(r.raw)}`}}},scales:{x:{stacked:!0,grid:{display:!1},border:{color:"#d5d6d7"}},y:{stacked:!0,beginAtZero:!0,ticks:{maxTicksLimit:8,callback:r=>formatMoney(r,0)},grid:{color:"#d5d6d7"},border:{dash:[5,5],color:"#d5d6d7"}},y2:{position:"right",min:0,max:100,ticks:{maxTicksLimit:6,callback:r=>formatPercent(r/100,0)},grid:{drawOnChartArea:!1,color:"#d5d6d7"},border:{color:"#d5d6d7"}}}}})}function renderMarginChart(r,t){new Chart(r,{type:"doughnut",data:{datasets:[{data:[{x:I18N.chart.shipping,value:t.shippingRevenue},{x:I18N.chart.pickup,value:t.pickupRevenue}],backgroundColor:["#2f88ff","#1060d6"],hoverBackgroundColor:["#2f88ff","#1060d6"],borderColor:"#fff",hoverBorderColor:"#fff",borderWidth:3,borderRadius:12},{data:[{x:I18N.chart.profit,value:t.totalProfit},{x:I18N.chart.shippingCosts,value:t.totalShipping},{x:I18N.chart.fees,value:t.totalFees},{x:I18N.chart.refund,value:t.totalRefund}],backgroundColor:["#78ac4c","#ffbb00","#fb6542","#698bbe"],hoverBackgroundColor:["#78ac4c","#ffbb00","#fb6542","#698bbe"],borderColor:"#fff",hoverBorderColor:"#fff",borderWidth:3,borderRadius:12},{data:[{x:I18N.chart.margin,value:t.profitMargin},{value:100-t.profitMargin}],backgroundColor:["#000","rgba( 0 0 0 / 0 )"],hoverBackgroundColor:["#000","rgba( 0 0 0 / 0 )"],borderColor:"#fff",hoverBorderColor:"#fff",borderWidth:3,borderRadius:12}]},options:{cutout:"40%",plugins:{legend:{position:"left",labels:{font:{size:15},boxWidth:24,generateLabels:()=>[{text:I18N.chart.shipping,fillStyle:"#2f88ff"},{text:I18N.chart.pickup,fillStyle:"#1060d6"},{text:I18N.chart.profit,fillStyle:"#78ac4c"},{text:I18N.chart.shippingCosts,fillStyle:"#ffbb00"},{text:I18N.chart.fees,fillStyle:"#fb6542"},{text:I18N.chart.refund,fillStyle:"#698bbe"},{text:I18N.chart.margin,fillStyle:"#000"}]}},tooltip:{filter:r=>!(2==r.datasetIndex&&1==r.dataIndex),callbacks:{label:r=>`${r.raw.x}: ${2==r.datasetIndex?formatPercent(r.raw.value/100):formatMoney(r.raw.value)}`}}}}})}function renderFlowChart(r,t){const o={order:{label:I18N.chart.order,color:"#ccc"},shipping:{label:I18N.chart.shipping,color:"#89b5f6"},pickup:{label:I18N.chart.pickup,color:"#89b5f6"},profit:{label:I18N.chart.profit,color:"#9fc67e"},shippingCost:{label:I18N.chart.shippingCosts,color:"#ffcf4d"},fees:{label:I18N.chart.fees,color:"#fda28d"},refund:{label:I18N.chart.refund,color:"#c2d0e4"}},e=new Map;function a(r,t,o){const a=`${r}-${t}`;e.has(a)?e.get(a).flow+=o:e.set(a,{from:r,to:t,flow:o})}for(const r of t)a("#"+r.orderNumber,r.orderType,r.revenue),r.profit>0&&a(r.orderType,"profit",r.profit),r.shipping>0&&a(r.orderType,"shippingCost",r.shipping),r.fees>0&&a(r.orderType,"fees",r.fees),r.refund>0&&a(r.orderType,"refund",r.refund);const l=Array.from(e.values());new Chart(r,{type:"sankey",data:{datasets:[{labels:Object.fromEntries(Object.entries(o).map((([r,t])=>[r,t.label]))),data:l,colorFrom:r=>o[r.raw.from]?.color||"#ccc",colorTo:r=>o[r.raw.to]?.color||"#ccc",hoverColorFrom:r=>o[r.raw.from]?.color||"#ccc",hoverColorTo:r=>o[r.raw.to]?.color||"#ccc",colorMode:"gradient",alpha:1,nodeWidth:20,nodePadding:10,borderColor:"#fff",borderWidth:16,font:{weight:"bold"}}]},options:{plugins:{tooltip:{displayColors:!1,callbacks:{label:r=>`${o[r.raw.to]?.label??r.raw.to}: ${formatMoney(r.raw.flow)}`}}}}})}document.addEventListener("DOMContentLoaded",(function(){Chart.defaults.responsive=!0,Chart.defaults.maintainAspectRatio=!1,Chart.defaults.offset=!1,Chart.defaults.layout.padding=0,Chart.defaults.font.family="SUSE, sans-serif",Chart.defaults.font.size=14,Chart.defaults.font.weight=400,Chart.defaults.color="#000",Chart.defaults.transitions={active:{animation:{duration:0}}},Chart.defaults.animations={x:{duration:0},y:{duration:150,easing:"easeOutBack"}},Chart.defaults.plugins.tooltip.padding={top:10,left:12,right:16,bottom:10},Chart.defaults.plugins.tooltip.animation={duration:150,easing:"easeOutBack"},Chart.defaults.plugins.tooltip.titleColor="#000",Chart.defaults.plugins.tooltip.bodyColor="#000",Chart.defaults.plugins.tooltip.backgroundColor="#fff",Chart.defaults.plugins.tooltip.borderColor="#d5d6d7",Chart.defaults.plugins.tooltip.borderWidth=1,Chart.defaults.plugins.tooltip.cornerRadius=5,Chart.defaults.plugins.tooltip.boxPadding=4,document.querySelectorAll(".chart-container").forEach((r=>{const t=JSON.parse(r.querySelector(".chartdata").textContent),o=r.getAttribute("chart-type"),e=r.querySelector(".chart");switch(e.classList.add(o),o){case"report":renderReportChart(e,t);break;case"margin":renderMarginChart(e,t);break;case"flow":renderFlowChart(e,t);break}}))}));